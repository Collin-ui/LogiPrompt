<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LogiPrompt v2.3</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap">
<style>
/* --- ALTES DESIGN 1:1 übernommen --- */
body { margin:0; font-family:'Roboto',sans-serif; background:#f5faff; color:#333;}
header { background:#0077cc; color:#fff; padding:1rem 2rem; font-size:1.5rem; font-weight:bold; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
#menuToggle{font-size:1.5rem;cursor:pointer;user-select:none;}
#container{display:flex; min-height:90vh; transition:all 0.3s;}
nav{width:250px;background:#e6f2ff; padding:1rem; box-shadow:2px 0 5px rgba(0,0,0,0.1); transition:all 0.3s; overflow:auto;}
nav.closed{width:60px;}
nav img{width:50px;height:50px;border-radius:50%;display:block;margin:0 auto 1rem auto;object-fit:cover;}
nav ul{list-style:none;padding:0;}
nav li{padding:0.8rem; margin-bottom:0.5rem; background:#d0e7ff; border-radius:5px; cursor:pointer; transition:0.3s; text-align:center;}
nav li:hover{background:#a6d1ff;}
main{flex:1;padding:2rem; transition:all 0.3s;}
.hidden{display:none;}
input, select, textarea, button{display:block;margin-bottom:1rem;padding:0.5rem;width:100%;font-size:1rem;border-radius:5px;border:1px solid #ccc;}
button{background:#0077cc;color:#fff;border:none;border-radius:5px;cursor:pointer;}
button:hover{background:#005fa3;}
.tooltip{display:inline-block;position:relative;cursor:pointer;color:#0077cc;font-weight:bold;}
.tooltip .tooltiptext{visibility:hidden;width:200px;background:#0077cc;color:#fff;text-align:center;border-radius:5px;padding:0.5rem;position:absolute;z-index:1;bottom:125%;left:50%;margin-left:-100px;opacity:0;transition:opacity 0.3s;}
.tooltip:hover .tooltiptext{visibility:visible;opacity:1;}
#promptOutput{background:#f0f8ff;padding:1rem;border-radius:5px;margin-top:1rem;min-height:80px;white-space:pre-wrap;}
#rating{display:flex;margin-top:1rem;gap:5px;}
.box{width:30px;height:30px;border:1px solid #ccc;border-radius:3px;background:#eee;}
.active{background:#00cc44;}
.status{margin-top:1rem;color:#0077cc;font-weight:bold;}
#truckAnimation{width:50px;height:50px;margin:1rem 0;transition:transform 2s ease-in-out;}
</style>
</head>
<body>
<header>
    LogiPrompt v2.3
    <span id="menuToggle">☰</span>
</header>
<div id="container">
    <nav class="closed" id="sideMenu" style="display:none;">
        <img id="profilePicMenu" src="https://via.placeholder.com/50" alt="Profilbild">
        <ul>
            <li onclick="showPage('profile')">Profil</li>
            <li onclick="showPage('prompt')">Prompt Erstellung</li>
            <li onclick="showPage('favorites')">Favoriten</li>
        </ul>
    </nav>
    <main>
        <!-- Anmeldung / Registrierung -->
        <div id="loginPage">
            <h2>Anmeldung / Registrierung</h2>
            <input type="text" id="name" placeholder="Name">
            <input type="text" id="role" placeholder="Rolle in der Firma">
            <input type="text" id="company" placeholder="Firmenname">
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="password" placeholder="Passwort">
            <label><input type="checkbox" id="stayLoggedIn"> Angemeldet bleiben</label>
            <button onclick="login(false)">Weiter</button>
            <button onclick="login(true)">Speichern & Fortsetzen</button>
        </div>

        <!-- Profilseite -->
        <div id="profilePage" class="hidden">
            <h2>Profil</h2>
            <input type="text" id="profileName" placeholder="Name">
            <input type="text" id="profileRole" placeholder="Rolle in der Firma">
            <input type="text" id="profileCompany" placeholder="Firmenname">
            <input type="email" id="profileEmail" placeholder="Email">
            <input type="file" id="profilePic">
            <button onclick="saveProfile()">Profil speichern</button>
            <div class="status" id="profileStatus"></div>
        </div>

        <!-- Prompt-Erstellung -->
        <div id="promptPage" class="hidden">
            <h2>Prompt Erstellung</h2>
            <label class="tooltip">i<span class="tooltiptext">Gib das Thema des Prompts ein (z.B. Ermahnung)</span></label>
            <input type="text" id="keyword" placeholder="Thema / Schlüsselwort" required>

            <label class="tooltip">i<span class="tooltiptext">Rolle des Adressaten auswählen</span></label>
            <select id="recipientRole">
                <option value="Fahrerpersonal">Fahrerpersonal</option>
                <option value="Logistikleitung">Logistikleitung</option>
                <option value="Disponent">Disponent</option>
            </select>

            <label class="tooltip">i<span class="tooltiptext">Name des Empfängers</span></label>
            <input type="text" id="recipientName" placeholder="Empfänger Name">

            <label class="tooltip">i<span class="tooltiptext">Tonfall auswählen</span></label>
            <select id="tone">
                <option value="ernst">Ernst</option>
                <option value="lösungsorientiert">Lösungsorientiert</option>
                <option value="freundlich">Freundlich</option>
            </select>

            <label class="tooltip">i<span class="tooltiptext">Textformat auswählen</span></label>
            <select id="textFormat">
                <option value="Email">Email</option>
                <option value="Brief">Brief</option>
                <option value="Memo">Memo</option>
            </select>

            <label class="tooltip">i<span class="tooltiptext">Sprache auswählen</span></label>
            <select id="language">
                <option value="Deutsch">Deutsch</option>
                <option value="Englisch">Englisch</option>
                <option value="Französisch">Französisch</option>
            </select>

            <button onclick="generatePrompt()">Prompt generieren</button>
            <button onclick="resetFields()">Zurücksetzen</button>

            <img id="truckAnimation" src="https://cdn-icons-png.flaticon.com/512/616/616408.png">

            <div id="promptOutput"></div>
            <button onclick="copyPrompt()">Prompt kopieren</button>
            <button onclick="saveFavorite()">Zu Favoriten hinzufügen</button>
            <div class="status" id="promptStatus"></div>

            <div id="rating">
                <div class="box" id="box1"></div>
                <div class="box" id="box2"></div>
                <div class="box" id="box3"></div>
                <div class="box" id="box4"></div>
                <div class="box" id="box5"></div>
            </div>
        </div>

        <!-- Favoriten -->
        <div id="favoritesPage" class="hidden">
            <h2>Favoriten</h2>
            <label>Sortieren:
                <select id="sortFavorites" onchange="renderFavorites()">
                    <option value="newest">Neueste → Älteste</option>
                    <option value="oldest">Älteste → Neueste</option>
                </select>
            </label>
            <div id="favoritesList"></div>
        </div>
    </main>
</div>

<script>
// --- Navigation Menu Toggle ---
const menuToggle = document.getElementById('menuToggle');
const sideMenu = document.getElementById('sideMenu');
menuToggle.onclick = () => sideMenu.classList.toggle('closed');

// --- User & Storage ---
let currentUser = null;

// Navigation
function showPage(page) {
    ['loginPage','profilePage','promptPage','favoritesPage'].forEach(p => document.getElementById(p).classList.add('hidden'));
    document.getElementById(page+'Page')?.classList.remove('hidden');
}

// Login / Registrierung
function login(save=false) {
    const name = document.getElementById('name').value;
    const role = document.getElementById('role').value;
    const company = document.getElementById('company').value;
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;

    if(save) {
        if(!name||!role||!company||!email||!password){alert("Bitte alle Felder ausfüllen!"); return;}
        currentUser={name,role,company,email,password};
        localStorage.setItem('currentUser',JSON.stringify(currentUser));
        if(document.getElementById('stayLoggedIn').checked) localStorage.setItem('stayLoggedIn','true');
        else localStorage.removeItem('stayLoggedIn');
    } else {
        let stored=localStorage.getItem('currentUser');
        currentUser=stored?JSON.parse(stored):{name:'',role:'',company:'',email:''};
    }

    document.getElementById('profileName').value=currentUser.name;
    document.getElementById('profileRole').value=currentUser.role;
    document.getElementById('profileCompany').value=currentUser.company;
    document.getElementById('profileEmail').value=currentUser.email;
    if(currentUser.profilePic) document.getElementById('profilePicMenu').src=currentUser.profilePic;

    sideMenu.style.display='block';
    showPage('prompt');
}

// Profil speichern
function saveProfile() {
    currentUser.name=document.getElementById('profileName').value;
    currentUser.role=document.getElementById('profileRole').value;
    currentUser.company=document.getElementById('profileCompany').value;
    currentUser.email=document.getElementById('profileEmail').value;

    const picFile=document.getElementById('profilePic').files[0];
    if(picFile){
        const reader=new FileReader();
        reader.onload=function(e){
            currentUser.profilePic=e.target.result;
            localStorage.setItem('currentUser',JSON.stringify(currentUser));
            document.getElementById('profilePicMenu').src=currentUser.profilePic;
            showPopup("Profil gespeichert!");
        };
        reader.readAsDataURL(picFile);
    } else {
        localStorage.setItem('currentUser',JSON.stringify(currentUser));
        showPopup("Profil gespeichert!");
    }
}

// --- Prompt-Erstellung ---
function generatePrompt(){
    const keyword=document.getElementById('keyword').value;
    const recipientRole=document.getElementById('recipientRole').value;
    const recipientName=document.getElementById('recipientName').value;
    const tone=document.getElementById('tone').value;
    const textFormat=document.getElementById('textFormat').value;
    const language=document.getElementById('language').value;

    if(!keyword){alert("Thema ist Pflichtfeld!");return;}

    // LKW Animation
    const truck=document.getElementById('truckAnimation');
    truck.style.transform="translateX(400px)";
    setTimeout(()=>truck.style.transform="translateX(0px)",2000);

    // Grundtext exakt wie alte Version:
    const prompt=`Von: ${currentUser.name}, ${currentUser.role}, ${currentUser.company}
An: ${recipientName} (${recipientRole})
Tonfall: ${tone}
Format: ${textFormat}
Sprache: ${language}
Thema: ${keyword}

Bitte verfasse einen professionellen Text basierend auf diesen Angaben.`;

    document.getElementById('promptOutput').innerText=prompt;
    showPopup("Prompt generiert!");

    // Bewertung
    const fields=[keyword,recipientRole,recipientName,tone,textFormat,language];
    const filled=fields.filter(f=>f).length;
    for(let i=1;i<=5;i++) document.getElementById('box'+i).classList.toggle('active',i<=Math.min(filled,5));
}

function resetFields(){
    ['keyword','recipientRole','recipientName','tone','textFormat','language'].forEach(id=>{
        const el=document.getElementById(id);
        if(el.tagName=='SELECT') el.selectedIndex=0; else el.value='';
    });
    document.getElementById('promptOutput').innerText='';
    document.getElementById('promptStatus').innerText='';
    for(let i=1;i<=5;i++) document.getElementById('box'+i).classList.remove('active');
}

function copyPrompt(){
    const text=document.getElementById('promptOutput').innerText;
    if(!text)return;
    navigator.clipboard.writeText(text).then(()=>showPopup("Prompt kopiert!"));
}

// Favoriten
function saveFavorite(){
    const promptText=document.getElementById('promptOutput').innerText;
    if(!promptText)return;
    let favorites=JSON.parse(localStorage.getItem('favorites')||"[]");
    favorites.push({prompt:promptText,date:new Date().toISOString()});
    localStorage.setItem('favorites',JSON.stringify(favorites));
    showPopup("Favorit hinzugefügt!");
}

function renderFavorites(){
    const sort=document.getElementById('sortFavorites')?.value||'newest';
    let favorites=JSON.parse(localStorage.getItem('favorites')||"[]");
    if(sort==='newest') favorites=favorites.slice().reverse();
    const container=document.getElementById('favoritesList');
    container.innerHTML='';
    favorites.forEach((f,i)=>{
        const div=document.createElement('div');
        div.style.border='1px solid #ccc';
        div.style.padding='0.5rem';
        div.style.marginBottom='0.5rem';
        div.innerHTML=`<pre>${f.prompt}</pre>
        <button onclick="removeFavorite(${i})">Entfernen</button>`;
        container.appendChild(div);
    });
}

function removeFavorite(index){
    let favorites=JSON.parse(localStorage.getItem('favorites')||"[]");
    favorites.splice(index,1);
    localStorage.setItem('favorites',JSON.stringify(favorites));
    renderFavorites();
}

// Popups
function showPopup(message){
    const popup=document.createElement('div');
    popup.style.position='fixed';
    popup.style.bottom='20px';
    popup.style.right='20px';
    popup.style.background='#0077cc';
    popup.style.color='#fff';
    popup.style.padding='1rem';
    popup.style.borderRadius='5px';
    popup.style.boxShadow='0 2px 5px rgba(0,0,0,0.3)';
    popup.style.zIndex=1000;
    popup.innerText=message;
    document.body.appendChild(popup);
    setTimeout(()=>popup.remove(),2000);
}

// Auto login
window.onload=function(){
    if(localStorage.getItem('stayLoggedIn') && localStorage.getItem('currentUser')){
        currentUser=JSON.parse(localStorage.getItem('currentUser'));
        document.getElementById('profileName').value=currentUser.name;
        document.getElementById('profileRole').value=currentUser.role;
        document.getElementById('profileCompany').value=currentUser.company;
        document.getElementById('profileEmail').value=currentUser.email;
        if(currentUser.profilePic) document.getElementById('profilePicMenu').src=currentUser.profilePic;
        sideMenu.style.display='block';
        showPage('prompt');
    }
};
</script>
</body>
</html>
